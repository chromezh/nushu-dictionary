image: ubuntu1804

branches:
  only:
    - proto

environment:
  access_token:
    secure: 1Ep5ZXTk0f1AbqY1xVTGnHWDEEBnSm2RnlExqhH0AsAPS1cRYl9aJRHDonSioUOD

before_build:
- wget -P ~ https://github.com/jgm/pandoc/releases/download/2.7.3/pandoc-2.7.3-1-amd64.deb
- sudo dpkg -i ~/pandoc-2.7.3-1-amd64.deb

build_script:
- mkdir -p ../build
- pandoc -s index/zh-Hans.md -o ../build/index.html -c index.files/index.css
- pandoc -s index/zh-Hant.md -o ../build/index-zh-Hant.html -c index.files/index.css
- pandoc -s index/en.md -o ../build/index-en.html -c index.files/index.css
- cp -ruv index.files meta/* nsbzz unicode ../build

after_build:
- git config --global credential.helper store
- echo "https://${access_token}:x-oauth-basic@github.com" >> ~/.git-credentials
- git config --global user.email "32255369+chromezh@users.noreply.github.com"
- git config --global user.name "sgalal"
- git checkout master
- rm -rf *
- mv -f ../build/* .
- git add .
- |-
  if [ -n "$(git status --porcelain)" ]; then
    git commit -m "Deploy $APPVEYOR_REPO_COMMIT by AppVeyor"
    git push origin master
  fi
